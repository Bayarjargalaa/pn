import streamlit as st
import pandas as pd

st.set_page_config(page_title="–°–∞—Ä –±“Ø—Ä–∏–π–Ω –∞—à–∏–≥ –∞–ª–¥–∞–≥–¥–ª—ã–Ω —Ç–∞–π–ª–∞–Ω", layout="centered")
st.title("üìä –°–∞—Ä –±“Ø—Ä–∏–π–Ω –∞—à–∏–≥ –∞–ª–¥–∞–≥–¥–ª—ã–Ω —Ç–∞–π–ª–∞–Ω")
df= pd.read_excel("–ï–ñ.xlsx")
# üìÇ –ì“Ø–π–ª–≥—ç—ç–Ω–∏–π —Ñ–∞–π–ª –±–∞–π—Ä—à—É—É–ª–∞—Ö
# uploaded_file = st.file_uploader("–ï—Ä”©–Ω—Ö–∏–π –∂—É—Ä–Ω–∞–ª—ã–Ω Excel —Ñ–∞–π–ª –æ—Ä—É—É–ª–Ω–∞ —É—É", type=["xlsx"])



# üßπ –ë—ç–ª—Ç–≥—ç—Ö
df['–û–≥–Ω–æ–æ'] = pd.to_datetime(df['—Å–∞—Ä, ”©–¥”©—Ä'])



# –î–∞–Ω—Å –±–æ–ª–æ–Ω –¥“Ø–Ω–≥ –Ω—ç–≥ –±–∞–≥–∞–Ω–∞ –±–æ–ª–≥–æ–Ω –Ω—ç–≥—Ç–≥—ç—Ö
debet_df = df[["–û–≥–Ω–æ–æ", "–î–µ–±–µ—Ç", "–î“Ø–Ω"]].rename(columns={"–î–µ–±–µ—Ç": "–î–∞–Ω—Å –∫–æ–¥"})
# credit_df = df[["–û–≥–Ω–æ–æ", "–ö—Ä–µ–¥–∏—Ç", "–î“Ø–Ω"]].rename(columns={"–ö—Ä–µ–¥–∏—Ç": "–î–∞–Ω—Å –∫–æ–¥"})

# –î–∞–Ω—Å –∫–æ–¥ + –û–≥–Ω–æ–æ–≥–æ–æ—Ä –Ω—ç–≥—Ç–≥—ç—Ö—ç–¥ –±—ç–ª–¥—ç—Ö
all_df = pd.concat([debet_df,], ignore_index=True)

# –°–∞—Ä—ã–Ω —Ñ–æ—Ä–º–∞—Ç –≥–∞—Ä–≥–∞—Ö (—Ö“Ø—Å–≤—ç–ª)
all_df["–°–∞—Ä"] = all_df["–û–≥–Ω–æ–æ"].dt.to_period("M")

# –ù–∏–π–ª–±—ç—Ä–∏–π–≥ –≥–∞—Ä–≥–∞—Ö
pivot = all_df.groupby(["–°–∞—Ä", "–î–∞–Ω—Å –∫–æ–¥"])["–î“Ø–Ω"].sum().reset_index()


# # üéØ –î–∞–Ω—Å–Ω—ã –∫–æ–¥–æ–æ—Å –∞–Ω–≥–∏–ª–∞–ª —Ç–æ–¥–æ—Ä—Ö–æ–π–ª–æ—Ö
# def classify(account_code):
#     if account_code.startswith("5101"):
#         return "–û—Ä–ª–æ–≥–æ"
#     elif account_code.startswith("6101"):
#         return "”®—Ä—Ç”©–≥"
#     elif account_code.startswith("70") or account_code.startswith("71"):
#         return "“Æ–π–ª –∞–∂–∏–ª–ª–∞–≥–∞–∞–Ω—ã –∑–∞—Ä–¥–∞–ª"
#     else:
#         return "–ë—É—Å–∞–¥"

# df['–ê–Ω–≥–∏–ª–∞–ª'] = df['–î–∞–Ω—Å –∫–æ–¥'].apply(classify)

# # üíµ –î“Ø–Ω —Ç–æ–æ—Ü–æ—Ö
# df['–î“Ø–Ω'] = df.apply(lambda x: x['–ö—Ä–µ–¥–∏—Ç'] if x['–ê–Ω–≥–∏–ª–∞–ª'] == "–û—Ä–ª–æ–≥–æ" else x['–î–µ–±–µ—Ç'], axis=1)

# # üìä Pivot Table “Ø“Ø—Å–≥—ç—Ö
# pivot = df.groupby(['–°–∞—Ä', '–ê–Ω–≥–∏–ª–∞–ª'])['–î“Ø–Ω'].sum().unstack(fill_value=0)
# pivot['–¶—ç–≤—ç—Ä –∞—à–∏–≥'] = pivot.get('–û—Ä–ª–æ–≥–æ', 0) - pivot.get('”®—Ä—Ç”©–≥', 0) - pivot.get('“Æ–π–ª –∞–∂–∏–ª–ª–∞–≥–∞–∞–Ω—ã –∑–∞—Ä–¥–∞–ª', 0) - pivot.get('–°–∞–Ω—Ö“Ø“Ø–≥–∏–π–Ω –∑–∞—Ä–¥–∞–ª', 0)
print(pivot)

# üìà –•“Ø—Å–Ω—ç–≥—Ç —Ö–∞—Ä—É—É–ª–∞—Ö
st.subheader("–°–∞—Ä –±“Ø—Ä–∏–π–Ω –∞—à–∏–≥ –∞–ª–¥–∞–≥–¥–ª—ã–Ω —Ö“Ø—Å–Ω—ç–≥—Ç")
st.dataframe(pivot)

# üìâ –ì—Ä–∞—Ñ–∏–∫
# st.line_chart(pivot['–¶—ç–≤—ç—Ä –∞—à–∏–≥'])
